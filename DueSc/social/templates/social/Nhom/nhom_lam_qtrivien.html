{% extends 'social/group.html' %}
{% load static %}

{% block content %}
<div class="w-full lg:w-3/5 xl:w-3/5 px-10 ml-72">
    <div class="w-full space-y-6 pl-8 pr-8 bg-gray-50">
        <h2 class="text-3xl font-bold text-gray-800">Nhóm bạn làm quản trị viên</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="space-y-4">
                {% for tv in nhom_lam_qtrivien %}
                <div class="flex items-center justify-between p-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-300">
                    <div class="flex items-center space-x-4">
                        <img src="{% static 'image/Nhom/nhom1.png' %}" alt="Avatar" class="rounded-full w-12 h-12">
                        <span class="text-lg text-gray-800">{{ tv.ma_nhom.ten_nhom }}</span>
                    </div>
                    <button class="bg-green-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition duration-300" onclick="window.location.href='{% url 'chi_tiet_nhom_qtrivien' ma_nhom=tv.ma_nhom.ma_nhom %}'">Xem nhóm</button>
                </div>
                {% empty %}
                <p class="text-gray-500">Bạn chưa làm quản trị viên nhóm nào.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block group_sidebar %}
<div class="flex justify-between">
    <!-- Cột bên trái (nội dung khác) -->
    <div id="contentLeft" class="w-3/4 p-6">
        <!-- Nội dung chính của bạn nằm ở đây -->
    </div>

    <!-- Cột phải: Danh sách nhóm -->
    <div id="contentRight" class="w-1/4 absolute top-0 right-0 p-6 space-y-6 z-10">
        <!-- Đặt độ rộng lớn hơn cho nhóm -->
        <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-800">Nhóm của bạn</h2>
            <div class="mt-4">
                <form method="GET" action="{% url 'search_groups' %}">
                    <input type="text" name="search" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Tìm kiếm nhóm" value="{{ request.GET.search }}">
                    <button type="submit" class="hidden"></button> <!-- Nút ẩn để submit form -->
                </form>
            </div>
            <div class="mt-4">
                <button id="openModal" class="inline-flex items-center bg-green-400 text-black font-semibold py-2 px-4 rounded-lg hover:bg-green-500">
                    <span class="text-2xl mr-2">+</span> Tạo nhóm mới
                </button>
            </div>
        </div>
        <!-- Các nhóm đã tham gia -->
        <div class="bg-white p-4 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800">Nhóm bạn đã tham gia</h3>
            <div class="mt-4 space-y-4">
                {% for tv in nhom_da_tham_gia|slice:":2" %}
                <div class="flex items-center space-x-4">
                    <img src="{% static 'image/Nhom/nhom1.png' %}" alt="Group" class="rounded-full w-12 h-12">
                    <span class="text-lg">{{ tv.ma_nhom.ten_nhom }}</span>
                </div>
                {% empty %}
                <p class="text-gray-500">Bạn chưa tham gia nhóm nào.</p>
                {% endfor %}
            </div>
            <a href="{% url 'nhom_da_tham_gia' %}" class="text-blue-600 hover:underline mt-4 inline-block">Xem thêm</a>
        </div>
        <!-- Chỉ hiển thị các nhóm làm quản trị viên -->
        <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-800">Nhóm bạn làm quản trị viên</h2>
            <div class="mt-4 space-y-4">
                {% for tv in nhom_lam_qtrivien|slice:":2" %}
                <div class="flex items-center space-x-4">
                    <img src="{% static 'image/Nhom/nhom1.png' %}" alt="Nhóm quản trị" class="rounded-full w-12 h-12">
                    <span class="text-lg">{{ tv.ma_nhom.ten_nhom }}</span>
                </div>
                {% empty %}
                <p class="text-gray-500">Bạn chưa làm quản trị viên nhóm nào.</p>
                {% endfor %}
            </div>
            <a href="{% url 'nhom_lam_qtrivien' %}" class="text-blue-600 hover:underline mt-4 inline-block">Xem thêm</a>
        </div>
    </div>
</div>

<!-- Modal tạo nhóm mới -->
<div id="createGroupModal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center hidden z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3 max-h-screen flex flex-col">
        <div class="modal-header flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Tạo nhóm</h2>
            <button id="closeCreateModal" class="text-gray-500 hover:bg-gray-100 p-1 rounded-full">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="createGroupForm" method="POST" action="{% url 'tao_nhom_moi' %}">
            {% csrf_token %}
            <div class="member flex items-center mb-4">
                <img src="{% if nguoi_dung.avatar %}{{ nguoi_dung.avatar.url }}{% else %}/static/default-avatar.png{% endif %}" alt="Avatar" class="w-10 h-10 rounded-full mr-2">
                <div>
                    <p class="font-semibold">{{ nguoi_dung.ho_ten }}</p>
                    <p class="text-gray-500 text-sm">Quản trị viên</p>
                </div>
            </div>
            <div class="mb-4">
                <label for="groupName" class="block text-gray-700 font-semibold mb-2">Tên Nhóm</label>
                <input type="text" id="groupName" name="group_name" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Tên Nhóm" required>
            </div>
            <div class="mb-4">
                <label for="groupDesc" class="block text-gray-700 font-semibold mb-2">Mô tả nhóm</label>
                <textarea id="groupDesc" name="group_description" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Mô tả nhóm" rows="5"></textarea>
            </div>
            <button type="submit" class="w-full bg-green-400 text-black font-semibold py-3 px-4 rounded-lg hover:bg-green-500">Gửi yêu cầu tạo nhóm</button>
        </form>
    </div>
</div>

<!-- JavaScript để mở và đóng modal tạo nhóm -->
<script>
   const openModalButton = document.getElementById('openModal');
   const createGroupModal = document.getElementById('createGroupModal');
   const closeCreateModalButton = document.getElementById('closeCreateModal');

   openModalButton.addEventListener('click', function() {
       createGroupModal.classList.remove('hidden');
   });

   closeCreateModalButton.addEventListener('click', function() {
       createGroupModal.classList.add('hidden');
   });

   window.addEventListener('click', function(event) {
       if (event.target === createGroupModal) {
           createGroupModal.classList.add('hidden');
       }
   });
</script>
{% endblock %}